<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionnaire d'Apprenants SharePoint</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.0/dist/umd/supabase.js"></script>
    <script src="https://alcdn.msauth.net/browser/2.38.1/js/msal-browser.min.js"></script>
</head>
<body>
    <div class="app-layout">
        
        <!-- Notification -->
        <div id="notification" class="notification hidden"></div>

        <!-- Header principal -->
        <header class="header-main">
            <div class="header-content">
                <div class="header-logo">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <rect width="32" height="32" rx="4" fill="#0078D4"/>
                        <path d="M8 8h7v7H8V8zm9 0h7v7h-7V8zM8 17h7v7H8v-7zm9 0h7v7h-7v-7z" fill="white"/>
                    </svg>
                    <h1>Gestionnaire SharePoint</h1>
                </div>
                <div class="header-actions">
                    <span id="connectionStatus" class="status-badge status-offline">
                        Déconnecté
                    </span>
                </div>
            </div>
        </header>

        <!-- Layout 3 colonnes -->
        <div class="main-layout">
            
            <!-- Sidebar gauche : Authentification -->
            <aside class="sidebar sidebar-left">
                
                <!-- Connexion Microsoft 365 -->
                <div class="card">
                    <div class="card-header">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.5 0L0 4.4v7.8c0 7.2 5 14 11.5 16.8 6.5-2.8 11.5-9.6 11.5-16.8V4.4L11.5 0z"/>
                        </svg>
                        <h2>Microsoft 365</h2>
                    </div>
                    <div class="card-body">
                        <div class="ms-logo-container">
                            <svg width="120" height="120" viewBox="0 0 96 96">
                                <rect width="44" height="44" fill="#f25022"/>
                                <rect x="52" width="44" height="44" fill="#7fba00"/>
                                <rect y="52" width="44" height="44" fill="#00a4ef"/>
                                <rect x="52" y="52" width="44" height="44" fill="#ffb900"/>
                            </svg>
                        </div>
                        <button id="btnLoginMicrosoft" class="btn btn-primary btn-block">
                            <i data-lucide="log-in"></i>
                            Se connecter
                        </button>
                        <button id="btnLogoutMicrosoft" class="btn btn-secondary btn-block hidden">
                            <i data-lucide="log-out"></i>
                            Se déconnecter
                        </button>
                        <div id="microsoftStatus" class="mt-3 text-sm text-center"></div>
                    </div>
                </div>

                <!-- Configuration Supabase -->
                <div class="card">
                    <div class="card-header">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M13.9 1.6L8.7 15.1c-.3.8.5 1.6 1.3 1.3l7.1-2.6c.5-.2.9-.7.9-1.2V2.8c0-.9-1-1.5-1.8-1.1l-2.3.9z"/>
                            <path d="M9.8 22.4l5.2-13.5c.3-.8-.5-1.6-1.3-1.3l-7.1 2.6c-.5.2-.9.7-.9 1.2v9.8c0 .9 1 1.5 1.8 1.1l2.3-.9z"/>
                        </svg>
                        <h2>Supabase</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>URL Projet</label>
                            <input 
                                type="text" 
                                id="supabaseUrl" 
                                class="input input-sm" 
                                placeholder="https://xxx.supabase.co"
                                value="https://neaxxyzhggofkmdpfgjg.supabase.co"
                            >
                        </div>
                        <div class="form-group">
                            <label>Clé Publique</label>
                            <input 
                                type="password" 
                                id="supabaseKey" 
                                class="input input-sm" 
                                placeholder="Clé anon"
                                value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5lYXh4eXpoZ2dvZmttZHBmZ2pnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2OTgzMzUsImV4cCI6MjA3NDI3NDMzNX0.2crri7mSdeHVHhun9hcu2w3j_xlc4J16-bhxTnABhYk"
                            >
                        </div>
                        <button id="btnConnect" class="btn btn-success btn-block">
                            <i data-lucide="database"></i>
                            Connecter
                        </button>
                    </div>
                </div>

                <!-- Statistiques -->
                <div class="card stats-card">
                    <div class="stat-item">
                        <i data-lucide="users"></i>
                        <div>
                            <span class="stat-label">Apprenants</span>
                            <span class="stat-value" id="statUsers">0</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i data-lucide="check-circle"></i>
                        <div>
                            <span class="stat-label">Inscriptions</span>
                            <span class="stat-value" id="statEnrollments">0</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <svg width="20" height="20" viewBox="0 0 96 96">
                            <rect width="44" height="44" fill="#036C70"/>
                            <rect x="52" width="44" height="44" fill="#13A10E"/>
                        </svg>
                        <div>
                            <span class="stat-label">Sites SharePoint</span>
                            <span class="stat-value" id="statSites">0</span>
                        </div>
                    </div>
                </div>

            </aside>

            <!-- Contenu central : Listing des utilisateurs -->
            <main class="content-main">
                
                <!-- Barre de recherche -->
                <div class="card search-card">
                    <div class="search-container">
                        <i data-lucide="search"></i>
                        <input 
                            type="text" 
                            id="searchInput" 
                            class="input search-input" 
                            placeholder="Rechercher un apprenant invité..."
                        >
                    </div>
                </div>

                <!-- Grille des utilisateurs -->
                <div class="card">
                    <div class="card-header">
                        <div class="flex-between">
                            <div class="flex-center gap-2">
                                <i data-lucide="users"></i>
                                <h2>Apprenants Invités (<span id="userCount">0</span>)</h2>
                            </div>
                            <span class="badge badge-info" id="selectedCount">0 sélectionnés</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="usersGrid" class="users-grid">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Chargement des apprenants...</p>
                            </div>
                        </div>
                        
                        <div id="emptyState" class="empty-state hidden">
                            <i data-lucide="users" class="empty-icon"></i>
                            <h3>Aucun apprenant trouvé</h3>
                            <p>Connectez-vous à Supabase et chargez vos données</p>
                        </div>
                    </div>
                </div>

            </main>

            <!-- Sidebar droite : Actions -->
            <aside class="sidebar sidebar-right">
                
                <!-- Inscriptions en attente -->
                <div class="card card-warning">
                    <div class="card-header">
                        <i data-lucide="clock"></i>
                        <h2>En attente</h2>
                    </div>
                    <div class="card-body">
                        <button id="btnRefreshPending" class="btn btn-outline btn-block mb-3">
                            <i data-lucide="refresh-cw"></i>
                            Actualiser
                        </button>
                        
                        <div id="pendingEnrollmentsContainer">
                            <div class="text-sm text-gray-600">Chargement...</div>
                        </div>

                        <div class="info-box mt-3">
                            <strong>PowerShell</strong>
                            <p class="text-xs mt-1">Exécutez le script pour traiter</p>
                            <code>.\Process-SharePointEnrollments.ps1</code>
                        </div>
                    </div>
                </div>

                <!-- Inscription en masse -->
                <div class="card">
                    <div class="card-header">
                        <i data-lucide="plus"></i>
                        <h2>Inscription</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Site SharePoint</label>
                            <select id="siteSelect" class="input">
                                <option value="">Sélectionner...</option>
                            </select>
                        </div>
                        
                        <button id="btnEnroll" class="btn btn-success btn-block" disabled>
                            <i data-lucide="plus"></i>
                            Inscrire
                        </button>

                        <div class="sharepoint-logo mt-4">
                            <svg width="100" height="100" viewBox="0 0 96 96">
                                <circle cx="48" cy="48" r="44" fill="#036C70"/>
                                <path d="M48 20c-15.5 0-28 12.5-28 28s12.5 28 28 28 28-12.5 28-28-12.5-28-28-28zm0 48c-11 0-20-9-20-20s9-20 20-20 20 9 20 20-9 20-20 20z" fill="white"/>
                                <circle cx="48" cy="48" r="12" fill="#13A10E"/>
                            </svg>
                        </div>
                    </div>
                </div>

            </aside>

        </div>

    </div>

    <!-- Scripts -->
    <script src="microsoft-graph.js"></script>
    <script src="supabase-client.js"></script>
    <script src="app.js"></script>
    <script>
        lucide.createIcons();
    </script>
</body>
</html>
                    <button id="btnConnect" class="btn btn-primary">
                        <i data-lucide="database"></i>
                        Connecter
                    </button>
                </div>
            </div>
        </section>

        <!-- Actions d'inscription -->
        <section class="card">
            <div class="card-header">
                <h2>
                    <i data-lucide="plus"></i>
                    Inscription en masse
                </h2>
            </div>
            <div class="card-body">
                <div class="enrollment-actions">
                    <div class="form-group flex-grow">
                        <label>Site SharePoint de destination</label>
                        <select id="siteSelect" class="input">
                            <option value="">Sélectionner un site...</option>
                        </select>
                    </div>
                    <div class="enrollment-info">
                        <span class="selected-count" id="selectedCount">0 sélectionnés</span>
                        <button id="btnEnroll" class="btn btn-primary" disabled>
                            <i data-lucide="plus"></i>
                            Inscrire
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Barre de recherche -->
        <section class="card">
            <div class="card-body">
                <div class="search-container">
                    <i data-lucide="search"></i>
                    <input 
                        type="text" 
                        id="searchInput" 
                        class="input search-input" 
                        placeholder="Rechercher par nom ou email..."
                    >
                </div>
            </div>
        </section>

        <!-- Liste des utilisateurs -->
        <section class="card">
            <div class="card-header">
                <h2>Utilisateurs non licenciés (<span id="userCount">0</span>)</h2>
            </div>
            <div class="card-body">
                <div id="usersGrid" class="users-grid">
                    <!-- Les utilisateurs seront injectés ici par JavaScript -->
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Chargement des données...</p>
                    </div>
                </div>
                
                <div id="emptyState" class="empty-state hidden">
                    <i data-lucide="users" class="empty-icon"></i>
                    <h3>Aucun apprenant trouvé</h3>
                    <p>Connectez-vous à Supabase et importez vos données</p>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>✅ Application HTML/CSS/JS + Supabase - Déployée sur Netlify</p>
            <p class="footer-info">Répertoire GitHub | Version 1.0.0</p>
        </footer>

    </div>

    <!-- Scripts -->
    <script src="supabase-client.js"></script>
    <script src="app.js"></script>
    <script>
        // Initialiser les icônes Lucide
        lucide.createIcons();
    </script>
</body>
</html>